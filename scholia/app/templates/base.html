{% extends "bootstrap-base.html" %}

{% macro sparql_to_table_post(panel, options={}) -%}
// {{ panel }} table
sparqlToDataTablePost(`# tool: scholia
{% include aspect + '_' + panel + '.sparql' %}
`,
"#{{ panel }}-table", "{{ aspect }}_{{ panel }}.sparql",
options={{ options | tojson }});
{%- endmacro %}

{% macro sparql_to_table(panel, options={}) -%}
// {{ panel }} table
sparqlToDataTable(`# tool: scholia
{% include aspect + '_' + panel + '.sparql' %}
`,
"#{{ panel }}-table", "{{ aspect }}_{{ panel }}.sparql",
options={{ options | tojson }});
{%- endmacro %}

{% macro sparql_to_iframe(panel) -%}
// {{ panel }} iframe
sparqlToIframe(`# tool: scholia
{% include aspect + '_' + panel + '.sparql' %}`,
"#{{ panel }}-iframe", "{{ aspect }}_{{ panel }}.sparql");
{%- endmacro %}

{% macro sparql_to_matrix(panel) -%}
// {{ panel }} matrix
sparqlToMatrix(`# tool: scholia
{% include aspect + '_' + panel + '.sparql' %}`,
"#{{ panel }}", "{{ aspect }}_{{ panel }}.sparql");
{%- endmacro %}

{% macro sparql_to_pathway_viewer(panel) -%}
// {{ panel }} optional viewer
sparqlToPathWayPageViewer(`# tool: scholia
{% include aspect + '_' + panel + '.sparql' %}`,
"{{ aspect }}_{{ panel }}.sparql" );
{%- endmacro %}

{% macro sparql_to_404shortinchikey(panel) -%}
// {{ panel }} short_inchikey
sparqlToShortInchiKey(`# tool: scholia
{% include aspect + '_' + panel + '.sparql' %}`,
"{{inchikey}}",
"#{{ panel }}-table", "{{ aspect }}_{{ panel }}.sparql" );
{%- endmacro %}

{% macro quick_statement(doi, element) -%}
quickStatement404DOI( "{{ doi }}" ,"#{{ element }}")
{%- endmacro %}




{% block metas %}
<meta charset="UTF-8">
<meta name="robots" content="index, nofollow">

<meta name="og:url" content="{{ 'https://scholia.toolforge.org' + request.path }}" />
<meta name="og:site_name" content="Scholia" />
<meta name="og:image" content="{{ url_for('static', filename='images/scholia_social_media.png') }}" />

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@WDScholia" />
{% endblock metas %}


{% block head %}
{{super()}}

<link rel="canonical" href="{{ 'https://scholia.toolforge.org' + request.path }}">

<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='jquery.dataTables.min.css') }}">
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/scholia.css') }}">
{% include "favicon.html" %}

{% endblock %}

{% block title %}Scholia{% endblock %}

{% block scripts %}
{{super()}}

<script type="text/javascript" src="{{ url_for('static', filename='d3.v5.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='d3-scale-chromatic.v1.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='jquery.dataTables.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='scholia.js') }}"></script>
<link href="{{ url_for('static', filename='widgets/select2/css/select2.min.css') }}" rel="stylesheet" />
<script type="text/javascript" src="{{ url_for('static', filename='widgets/select2/js/select2.min.js')}}"></script>
<script src="{{ url_for('static', filename='js/citation.js') }}"></script>
<script type="text/javascript">

  {% if q %}
    
	workWithQ("{{ q }}", urlstatic="{{ url_for('static',filename='') }}")

	{% if q2 %}
	  workWithQ2("{{ q2 }}")
	{% endif %}
	
	// this query opens the Wikidata item as a different aspect
	wikiItemAsDifferentAspect(`{% include 'base_different-aspect.sparql' %}`, 
							  "{{ q }}", 
							  "{{ url_for('app.index') }}")

    // this query opens a subpage for the Wikidata item, e.g. as cito subpage
	wikiItemSubpage(`{% include 'base_aspect-subpage.sparql' %}`, 
	 			     "{{ q }}", 
				   	 "{{ url_for('app.index') }}")

    /* Wembedder */
    wembedder("{{ q }}")

  {% endif %}

 $(document).ready(function () {
	 searchTerm(placeholder=`{{ 
		 "Scientist, paper, topic, DOI, etc." if request.path.endswith("search") else "Search ..."
		}}`,
		urlfor="{{ url_for('app.index') }}")
    
	// Add anchor links to all headings
	var headers = document.querySelectorAll('h2[id], h3[id]')
     if (headers) {
       headers.forEach(element => {
         var title = element.innerText;
         element.removeChild(element.childNodes[0])
         element.insertAdjacentHTML('afterbegin', `<a href="#${element.id}" class="hlink"  ariaLabel="Anchor">${title}</a>`)
       })
     }

     // Add table of content
  var headings = document.querySelectorAll("h2,h3");
  if (headings.length >= 4) {
    var toc = document.createElement("div");
    toc.className = "table-of-contents"

    tocTitle = document.createElement("b");
    tocTitle.innerText = "Table of Contents"
    toc.appendChild(tocTitle)

    var tocList = document.createElement("ul");
    var sublist = "";
    for (let i = 0; i < headings.length; i++) {
      const element = headings[i];
      if (!element.id) {
        element.id = element.innerText.replace(" ", "-")
      }
      if (element.tagName === "H3" && !sublist) {
        var sublist = document.createElement("ul");
      }
      tocListItem = document.createElement("li");

      tocEntry = document.createElement("a");
      tocEntry.setAttribute("href", "#" + element.id);
      tocEntry.innerText = headings[i].innerText;

      tocListItem.appendChild(tocEntry);

      if (element.tagName === "H3") {
        sublist.appendChild(tocListItem);
      } else {
        if (sublist) {
          tocList.appendChild(sublist);
          sublist = "";
        }
        tocList.appendChild(tocListItem);
      }
    }

    toc.appendChild(tocList)
    document.querySelector("h2").insertAdjacentElement("beforebegin", toc)
  }


     {% block in_ready %}{% endblock %}
 });

</script>

{% endblock %}

{% block navbar %}
<div class="navbar navbar-static-top">
    <ul class="nav nav-pills">
	<li role="presentation"><a href="{{ url_for('app.index') }}"><img src="{{ url_for('static', filename='images/scholia_wordmark.svg') }}" width="112px" height="24px" alt="Scholia"></a></li>
	<li role="presentation"><a href="{{ url_for('app.show_author_index') }}">Author</a></li>
	<li role="presentation">
	    <div class="dropdown">
		<button class="btn btn-link dropdown-toggle" 
			type="button" data-toggle="dropdown">Work
		    <span class="caret"></span></button>
		<ul class="dropdown-menu">
		    <li role="presentation"><a href="{{ url_for('app.show_work_empty') }}">Work</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_venue_empty') }}">Venue</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_series_empty') }}">Series</a></li>
                    <li role="presentation"><a href="{{ url_for('app.show_catalogue_empty') }}">Catalogue</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_publisher_empty') }}">Publisher</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_printer_index') }}">Printer</a></li>
		</ul>
	    </div>
	</li>
	<li role="presentation">
	    <div class="dropdown">
		<button class="btn btn-link dropdown-toggle" 
			type="button" data-toggle="dropdown">Organization
		    <span class="caret"></span></button>
		<ul class="dropdown-menu">
		    <li role="presentation"><a href="{{ url_for('app.show_organization_empty') }}">Organization</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_publisher_empty') }}">Publisher</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_printer_index') }}">Printer</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_sponsor_empty') }}">Sponsor</a></li>
		</ul>
	    </div>
	</li>
	<li role="presentation">
	    <div class="dropdown">
		<button class="btn btn-link dropdown-toggle" 
			type="button" data-toggle="dropdown">Location
		    <span class="caret"></span></button>
		<ul class="dropdown-menu">
		    <li role="presentation"><a href="{{ url_for('app.show_location_empty') }}">Location</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_country_empty') }}">Country</a></li>
		</ul>
	    </div>
	</li>
	<li role="presentation">
	    <div class="dropdown">
		<button class="btn btn-link dropdown-toggle" 
			type="button" data-toggle="dropdown">Event
		    <span class="caret"></span></button>
		<ul class="dropdown-menu">
		    <li role="presentation"><a href="{{ url_for('app.show_event_empty') }}">Event</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_event_series_empty') }}">Event series</a></li>
		</ul>
	    </div>
	</li>
	<li role="presentation">
	    <div class="dropdown">
		<button class="btn btn-link dropdown-toggle" 
			type="button" data-toggle="dropdown">Project
		    <span class="caret"></span></button>
		<ul class="dropdown-menu">
		    <li role="presentation"><a href="{{ url_for('app.show_clinical_trial_index') }}">Clinical trial</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_project_empty') }}">Project</a></li>
		</ul>
	    </div>
	</li>
	<li role="presentation"><a href="{{ url_for('app.show_award_empty') }}">Award</a></li>
	<li role="presentation">
	    <div class="dropdown">
		<button class="btn btn-link dropdown-toggle" 
			type="button" data-toggle="dropdown">Topic
		    <span class="caret"></span></button>
		<ul class="dropdown-menu">
		    <li role="presentation"><a href="{{ url_for('app.show_topic_empty') }}">General</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_disease_empty') }}">Disease</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_taxon_empty') }}">Taxon</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_gene_empty') }}">Gene</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_protein_empty') }}">Protein</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_pathway_empty') }}">Pathway</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_chemical_index') }}">Chemical</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_chemical_element_empty') }}">Chemical element</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_chemical_class_empty') }}">Chemical class</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_lexeme_empty') }}">Lexeme</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_use_empty') }}">Use</a></li>
		</ul>
	    </div>
	</li>
	<li role="presentation">
	    <div class="dropdown">
		<button class="btn btn-link dropdown-toggle" 
			type="button" data-toggle="dropdown">Tools
		    <span class="caret"></span></button>
		<ul class="dropdown-menu">
		    <li role="presentation"><a href="{{ url_for('app.show_arxiv_to_quickstatements') }}">Arxiv to Quickstatements</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_q_to_bibliography_templates') }}">Q to Bibliography templates</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_text_to_topics') }}">Text to topics</a></li>
		</ul>
	    </div>
	</li>

	<li role="presentation">
	    <div class="dropdown">
		<button class="btn btn-link dropdown-toggle" 
			type="button" data-toggle="dropdown">Help
		    <span class="caret"></span></button>
		<ul class="dropdown-menu">
		    <li role="presentation"><a href="{{ url_for('app.show_about') }}">About</a></li>
		    <li role="presentation"><a href="{{ url_for('app.index_statistics') }}">Statistics</a></li>
		    <li role="presentation"><a href="{{ url_for('app.show_faq') }}">FAQ</a></li>
		</ul>
	    </div>
	</li>
    
    </ul>
    {% block nav_search %}
    <div class='nav nav-search'>
	    <div class="input-group">
        <input type="text" id="searchterm"/>
        </div>
    </div>
    {% endblock %}
</div>
{% endblock %}

{% block content %}
<div class="content">
<div class="container">
    <span id="aspect-chooser"></span>
</div>
<div class="container">
    {% block page_content %}{% endblock %}
</div>
</div>
<div class="container footer">
    <hr>
    Data from <a href="https://www.wikidata.org">Wikidata</a> and
    <a href="https://en.wikipedia.org">English Wikipedia</a>
    |
    Code from
    <a href="https://github.com/WDscholia/scholia">GitHub repository</a>
    |
    Hosted on   <a href="https://toolforge.org/">Wikimedia Toolforge</a>,
    a <a href="https://wikimediafoundation.org">Wikimedia Foundation</a> service
    |
    License for content: CC0 for data, CC-BY-SA for text and media
    |
    Report technical problems at Scholia's
    <a href="https://github.com/WDscholia/scholia/issues">Issues</a> GitHub page.
    |
    Follow us on <a href="https://twitter.com/wdscholia">Twitter</a>.
    <hr>
  </div>
{% endblock %}

<script type="text/javascript">
    
</script>
